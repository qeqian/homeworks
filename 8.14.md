# 8.13

# 1. 串口通信USART:

- 是指数据按位逐个顺序传输的通信方式，与并口通信多位传输形成对比，慢但是成本低，抗干扰强.
- 数据传输方向: 单工（单向通道）；半双工 ；全双工。

# 2. UART：

- 通用异步收发器，最基本的串口通信接口。
- 数据以帧的形式传输，每帧包含起始位，5-8位数据位，可选的奇偶校验位，和1-2停止位。
- TGRV，线的顺序，串口通信时与外设t-r反接。

# 3. 配置通信协议：

- 波特率，表示每秒传输码元的个数，衡量数据传输速率的指标，单位Baud。

# 4. 串口通信寄存器：

- 三种模式：轮询模式，查询数据寄存器来实现数据收发，占用cpu ；中断模式 ；DMA模式，直接存储器访问，数据的直接输出
开设一条通道，将数据拷贝到另一个外设。

# 5.代码总结：

- 接收中断+swith实现循环依次接受，将串口输入的值接收到数组中,同时判断数据包中的包头和包尾。

```c
case 1:
         rx_packet.buff1[0]=u1_rx_data_temp;
			   rx_state=2;
			   break;
case 2:
				rx_packet.buff1[1]=u1_rx_data_temp;
			  rx_state=3;
			  break;
case 3:
				rx_packet.buff1[2]=u1_rx_data_temp;
			   rx_state=4;
			   break;
```

- 执行发送中断时，尽量判断一下串口的状态

```c
if (huart1.gState == HAL_UART_STATE_READY)
HAL_UART_Transmit_IT(&huart1, (uint8_t*)tx_buf, strlen(tx_buf));
```

- 原数据解析

```c
void parse_packet(void) {
    parsed_data.data32 = (rx_packet.buff1[3] << 24) |
                         (rx_packet.buff1[2] << 16) |
                         (rx_packet.buff1[1] << 8) |
                         rx_packet.buff1[0];
    
    parsed_data.data8_1 = rx_packet.buff1[4];
    parsed_data.data8_2 = rx_packet.buff1[5];
}
```

- sprintf(stdio.h),按地址将数据写入数组，%u十进制无符号

```c
    sprintf(tx_buf,"%u,%u,%u\r\n",parsed_data.data32, parsed_data.data8_1, parsed_data.data8_2);
```